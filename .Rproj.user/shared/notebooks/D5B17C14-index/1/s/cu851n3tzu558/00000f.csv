"0",""
"0","df %>%"
"0","  filter(!is.na(CPAL.EHQ.002)) %>%"
"0","  mutate(CPAL.EHQ.002 = factor("
"0","    case_when("
"0","      CPAL.EHQ.002 == 0 ~ ""No problems"","
"0","      CPAL.EHQ.002 == 1 ~ ""Minor problems"","
"0","      CPAL.EHQ.002 == 2 ~ ""Major problems"","
"0","      CPAL.EHQ.002 == 3 ~ ""Extreme problems"","
"0","    ),"
"0","    levels = c(""No problems"", ""Minor problems"", ""Major problems"", ""Extreme problems"")"
"0","  )) %>%"
"0","  group_by(CPAL.EHQ.002) %>%"
"0","  tally() %>%"
"0","  mutate(prop = n/sum(n)) %>%"
"0","  ggplot(aes(x = prop, y = CPAL.EHQ.002, fill = CPAL.EHQ.002)) +"
"0","  geom_bar(stat = ""identity"", position = ""dodge"", width = 0.7) +"
"0","  geom_text(aes(label = ifelse(prop > 0.1, scales::percent(prop, scale = 100), """")), "
"0","            position = position_dodge(width=0.9), "
"0","            hjust = 1.1, "
"0","            size = 8, "
"0","            colour = ""white"") +"
"0","  geom_text(aes(label = ifelse(prop <= 0.1, scales::percent(prop, scale = 100, accuracy = 0.1), """")), "
"0","        position = position_dodge(width=0.9), "
"0","        hjust = -0.1,"
"0","        size = 8, "
"0","        colour = ""grey"") +"
"0","  labs(fill = """") +"
"0","  theme_minimal() +"
"0","  theme("
"0","    legend.position = ""none"","
"0","    legend.key.size = unit(2, ""lines""), "
"0","    legend.text = element_text(size = 12),"
"0","    axis.title.x = element_blank(),"
"0","    axis.title.y = element_blank(),"
"0","    axis.text.y = element_text(size = 14),"
"0","    plot.background = element_rect(fill = ""transparent"", colour = NA),"
"0","    panel.background = element_rect(fill = ""transparent"", colour = NA),"
"0","    strip.background = element_rect(fill = ""transparent"", colour = NA),"
"0","    panel.grid.major.y = element_blank()"
"0","  ) +"
"0","  scale_fill_manual(values = colorRampPalette(c(""#ABABAB"", palette_cpal_main[2], ""#592523""))(5),"
"0","                    c(""No problems"", ""Minor problems"", ""Major problems"", ""Extreme problems"")) +"
"0","  scale_x_continuous(labels = scales::percent_format(scale = 100), expand = expansion(mult = c(0.1, 0)))"
